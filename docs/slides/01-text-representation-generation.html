<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Andrew Ellis">

<title>Promptly Literate // - LLMs: Text representation, training, and text generation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="..//assets/robot.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script type="application/json" class="js-hypothesis-config">
{
  "theme": "clean"
}
</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="Promptly Literate // - LLMs: Text representation, training, and text generation">
<meta property="og:site_name" content="Promptly Literate //">
<meta name="twitter:title" content="Promptly Literate // - LLMs: Text representation, training, and text generation">
<meta name="twitter:creator" content="@awellis">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Promptly Literate //</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../pages/agenda.html"> <i class="bi bi-calendar-event" role="img">
</i> 
<span class="menu-text">Agenda</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-slides" role="button" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-file-slides" role="img">
</i> 
 <span class="menu-text">Slides</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-slides">    
        <li>
    <a class="dropdown-item" href="../slides/workshop-global-management.html">
 <span class="dropdown-text">Workshop: Global Management</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../slides/prompt-labor-basics.html">
 <span class="dropdown-text">Prompt Labor: Basics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../slides/prompt-labor-vertiefung.html">
 <span class="dropdown-text">Prompt Labor: Vertiefung</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../slides/cas-hochschuldidaktik.html">
 <span class="dropdown-text">CAS Hochschuldidaktik</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../slides/busy-lecturers-guide.html">
 <span class="dropdown-text">The busy lecturer‚Äôs guide to LLMs</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-activities" role="button" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-brush" role="img">
</i> 
 <span class="menu-text">Activities</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-activities">    
        <li>
    <a class="dropdown-item" href="../pages/activity-global-management.html">
 <span class="dropdown-text">Activity: Workshop Global Management</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../pages/activities-20240223.html">
 <span class="dropdown-text">Activity: Confabulations and prompting</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../pages/activity-cas-hochschuldidaktik.html">
 <span class="dropdown-text">Activity: CAS</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../pages/activity-prompt-labor-vertiefung.html">
 <span class="dropdown-text">Activity: Prompt Labor: Vertiefung</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../pages/activity-0-explore-llms.html">
 <span class="dropdown-text">Exploring LLMs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../pages/activity-1-prompting-techniques.html">
 <span class="dropdown-text">Prompting techniques</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../pages/activity-2-prompting-learning-teaching.html">
 <span class="dropdown-text">Prompting for educational settings</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tutorials" role="button" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-book" role="img">
</i> 
 <span class="menu-text">Tutorials</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-tutorials">    
        <li>
    <a class="dropdown-item" href="../pages/text-representation.html">
 <span class="dropdown-text">Text representation: embeddings</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../pages/prompting.html">
 <span class="dropdown-text">Using the API: Prompting Programmatically</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-archive" role="button" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-archive" role="img">
</i> 
 <span class="menu-text">Archive</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-archive">    
        <li>
    <a class="dropdown-item" href="../slides/00-introduction.html">
 <span class="dropdown-text">Part 1: What is ChatGPT?</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../slides/01-text-representation-generation.html">
 <span class="dropdown-text">Further info: Text representation, training and text generation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../slides/02-prompting-techniques.html">
 <span class="dropdown-text">Part 2: Prompting techniques</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../slides/03-prompting-learning-teaching.html">
 <span class="dropdown-text">Part 3: Prompting for learning and teaching</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-resources" role="button" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-wrench-adjustable" role="img">
</i> 
 <span class="menu-text">Resources</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-resources">    
        <li>
    <a class="dropdown-item" href="../pages/resources.html">
 <span class="dropdown-text">Guides</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../pages/tools.html">
 <span class="dropdown-text">Tools</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
    <a href="https://virtuelleakademie.ch/knowledge-base/" title="Knowledge Base" class="quarto-navigation-tool px-1" aria-label="Knowledge Base"><i class="bi bi-lightbulb-fill"></i></a>
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/virtuelleakademie/promptly-literate/">
            Source Code
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/virtuelleakademie/promptly-literate/issues">
            Report a Bug
            </a>
          </li>
      </ul>
    </div>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#contents" id="toc-contents" class="nav-link active" data-scroll-target="#contents">Contents</a></li>
  <li><a href="#what-is-natural-language-processing-nlp" id="toc-what-is-natural-language-processing-nlp" class="nav-link" data-scroll-target="#what-is-natural-language-processing-nlp">What is natural language processing (NLP)?</a>
  <ul class="collapse">
  <li><a href="#what-is-nlp" id="toc-what-is-nlp" class="nav-link" data-scroll-target="#what-is-nlp">What is NLP?</a>
  <ul class="collapse">
  <li><a href="#brief-timeline" id="toc-brief-timeline" class="nav-link" data-scroll-target="#brief-timeline">Brief timeline</a></li>
  </ul></li>
  <li><a href="#long-range-dependencies" id="toc-long-range-dependencies" class="nav-link" data-scroll-target="#long-range-dependencies">Long-range dependencies</a></li>
  <li><a href="#key-areas-in-nlp" id="toc-key-areas-in-nlp" class="nav-link" data-scroll-target="#key-areas-in-nlp">Key areas in NLP</a></li>
  <li><a href="#example-sentiment-analysis-text-classification" id="toc-example-sentiment-analysis-text-classification" class="nav-link" data-scroll-target="#example-sentiment-analysis-text-classification">Example: sentiment analysis (text classification)</a></li>
  <li><a href="#machine-learning-primer" id="toc-machine-learning-primer" class="nav-link" data-scroll-target="#machine-learning-primer">Machine Learning primer</a></li>
  <li><a href="#supervised-learning" id="toc-supervised-learning" class="nav-link" data-scroll-target="#supervised-learning">Supervised learning</a></li>
  <li><a href="#reinforcement-learning" id="toc-reinforcement-learning" class="nav-link" data-scroll-target="#reinforcement-learning">Reinforcement learning</a></li>
  </ul></li>
  <li><a href="#what-is-chatgpt" id="toc-what-is-chatgpt" class="nav-link" data-scroll-target="#what-is-chatgpt">What is ChatGPT?</a>
  <ul class="collapse">
  <li><a href="#chatgpt" id="toc-chatgpt" class="nav-link" data-scroll-target="#chatgpt">ChatGPT</a></li>
  <li><a href="#text-generation" id="toc-text-generation" class="nav-link" data-scroll-target="#text-generation">Text generation</a></li>
  <li><a href="#text-generation-examples" id="toc-text-generation-examples" class="nav-link" data-scroll-target="#text-generation-examples">Text generation examples</a></li>
  <li><a href="#tokenization" id="toc-tokenization" class="nav-link" data-scroll-target="#tokenization">Tokenization</a></li>
  <li><a href="#embeddings" id="toc-embeddings" class="nav-link" data-scroll-target="#embeddings">Embeddings</a></li>
  </ul></li>
  <li><a href="#how-was-chatgpt-trained" id="toc-how-was-chatgpt-trained" class="nav-link" data-scroll-target="#how-was-chatgpt-trained">How was ChatGPT trained?</a>
  <ul class="collapse">
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  <li><a href="#pre-training-data" id="toc-pre-training-data" class="nav-link" data-scroll-target="#pre-training-data">Pre-training Data</a></li>
  <li><a href="#pre-training" id="toc-pre-training" class="nav-link" data-scroll-target="#pre-training">Pre-training</a></li>
  <li><a href="#supervised-fine-tuning" id="toc-supervised-fine-tuning" class="nav-link" data-scroll-target="#supervised-fine-tuning">Supervised fine-tuning</a></li>
  <li><a href="#reinforcement-learning-from-human-feedback-rlhf" id="toc-reinforcement-learning-from-human-feedback-rlhf" class="nav-link" data-scroll-target="#reinforcement-learning-from-human-feedback-rlhf">Reinforcement learning from human feedback (RLHF)</a></li>
  </ul></li>
  <li><a href="#how-should-we-think-about-llms" id="toc-how-should-we-think-about-llms" class="nav-link" data-scroll-target="#how-should-we-think-about-llms">How should we think about LLMs?</a>
  <ul class="collapse">
  <li><a href="#useful-analogy-role-playing-simulator" id="toc-useful-analogy-role-playing-simulator" class="nav-link" data-scroll-target="#useful-analogy-role-playing-simulator">Useful analogy: Role-playing simulator</a></li>
  <li><a href="#role-playing-simulator" id="toc-role-playing-simulator" class="nav-link" data-scroll-target="#role-playing-simulator">Role-Playing Simulator</a></li>
  </ul></li>
  <li><a href="#chatgpt-and-openai-playground" id="toc-chatgpt-and-openai-playground" class="nav-link" data-scroll-target="#chatgpt-and-openai-playground">ChatGPT and OpenAI Playground</a>
  <ul class="collapse">
  <li><a href="#chatgpt-vs-openai-playground" id="toc-chatgpt-vs-openai-playground" class="nav-link" data-scroll-target="#chatgpt-vs-openai-playground">ChatGPT vs OpenAI Playground</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="01-text-representation-generation.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">LLMs: Text representation, training, and text generation</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Andrew Ellis </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">23 October, 2023</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="contents" class="level1" data-background-color="#b48ead">
<h1 data-background-color="#b48ead">Contents</h1>
<ol type="1">
<li>What is natural language processing?</li>
<li>How do LLMs represent text?</li>
<li>What is ChatGPT?</li>
<li>How was ChatGPT trained??</li>
<li>How should we think about LLMs?</li>
<li>ChatGPT and OpenAI Playground?</li>
</ol>
<!-- ::: footer
<a href="https://virtuelleakademie.github.io/gpt-nano">üè† KI/GPT in der Hochschule</a>
::: -->
</section>
<section id="what-is-natural-language-processing-nlp" class="level1" data-background-color="#b48ead">
<h1 data-background-color="#b48ead">What is natural language processing (NLP)?</h1>
<div class="absolute" data-top="0" data-left="100%">
<div class="sectionhead">
<p>1 <span style="opacity:0.25">2 3 4 5 6</span></p>
</div>
</div>
<section id="what-is-nlp" class="level2">
<h2 class="anchored" data-anchor-id="what-is-nlp">What is NLP?</h2>
<ul>
<li>NLP is a subfield of <a href="(https://www.derbund.ch/so-funktioniert-kuenstliche-intelligenz-599276436215)">artificial intelligence (AI)</a>.</li>
<li>NLP is concerned with the interactions between computers and human (natural) languages.</li>
</ul>
<section id="brief-timeline" class="level3">
<h3 class="anchored" data-anchor-id="brief-timeline">Brief timeline</h3>
<ul>
<li>1950: Alan Turing proposed the Turing test to assess machine intelligence through conversation.</li>
<li>1954: IBM introduced the first machine translation system, translating Russian to English using rules.</li>
<li>1960s-1970s: Rule-based systems like SHRDLU and ELIZA used human-crafted rules for language interaction.</li>
<li>1980s-1990s: Statistical methods employed probabilities and text data, using models like Hidden Markov Models and n-grams.</li>
<li>2000s-present: NLP shifted to neural network methods with deep learning, employing recurrent neural networks for complex language tasks.</li>
<li>Transformers (first published in 2017) are the current state-of-the-art for NLP, and are the basis for large language models (LLMs), such as GPT-3.5, GPT-4, ChatGPT, Llama 2, and others.</li>
<li>LLMs are models with billions of parameters, trained on massive amounts of text data. Training consists of predicting the next word in a sequence of words.</li>
</ul>
</section>
</section>
<section id="long-range-dependencies" class="level2">
<h2 class="anchored" data-anchor-id="long-range-dependencies">Long-range dependencies</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Complicated sentence
</div>
</div>
<div class="callout-body-container callout-body">
<p>‚ÄúThe boy who was throwing stones at the birds, despite being warned by his parents not to harm any creatures, was chased by the angry flock.‚Äù</p>
</div>
</div>
<p>Who was chased?</p>
<ul>
<li>This type of long-range dependency is difficult for traditional NLP methods to handle.</li>
<li>The verb phrase (<code>the boy was chased</code>) is separated from the subject by a long distance - you can‚Äôt just look at the previous few words to answer the question.</li>
<li>Transformers have a special feature that lets them easily connect words that are far apart in a sentence; <code>was chased</code> is linked directly to <code>The boy</code> without distraction by the words in between.</li>
</ul>
</section>
<section id="key-areas-in-nlp" class="level2">
<h2 class="anchored" data-anchor-id="key-areas-in-nlp">Key areas in NLP</h2>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><code>Sentiment Analysis</code>: Identifying emotions and opinions in text.<br>
<code>Machine Translation</code>: Automatically translating between languages.<br>
<code>Question Answering</code>: Providing direct answers to user questions.<br>
<code>Text Summarization</code>: Generating concise summaries from long text.<br>
<code>Speech Recognition</code>: Converting spoken words to text.<br>
<code>Speech Synthesis</code>: Creating spoken words from text.<br>
<code>Natural Language Generation</code>: Generating human-like text.<br>
<code>Natural Language Understanding</code>: Extracting meaning from text.<br>
<code>Dialogue Systems</code>: Conversing with humans using natural language.</p>
</div>
</div>
</div>
<ul>
<li>Before LLMs, specialized models were trained for each task.</li>
<li>LLMs are general-purpose models that can perform a wide variety of tasks.</li>
</ul>
</section>
<section id="example-sentiment-analysis-text-classification" class="level2">
<h2 class="anchored" data-anchor-id="example-sentiment-analysis-text-classification">Example: sentiment analysis (text classification)</h2>
<p>The task of classifying text as positive, negative, or neutral.</p>
<ul>
<li><code>I love this movie!</code> ‚Üí positive üòä</li>
<li><code>This movie is ok.</code> ‚Üí neutral üòê</li>
<li><code>This movie is terrible!</code> ‚Üí negative üò†</li>
</ul>
</section>
<section id="machine-learning-primer" class="level2">
<h2 class="anchored" data-anchor-id="machine-learning-primer">Machine Learning primer</h2>
<ul>
<li><p>Earlier, rule-based systems had to be programmed.</p></li>
<li><p>Machine learning (ML) models learn implicitly, i.e.&nbsp;without rules being programmed in.</p></li>
<li><p>Important terms:</p>
<ul>
<li><strong>training data:</strong> Models are fed with data, and parameters of the model are adjusted so that the model is as ‚Äúgood‚Äù as possible.</li>
<li><strong>supervised learning:</strong> Categories known, e.g.&nbsp;classify images of animals.</li>
<li><strong>unsupervised learning:</strong> Categories are unknown, e.g.&nbsp;discover unknown patterns.</li>
<li><strong>reinforcement learning:</strong> The goal is given, and the model learns through feedback (reward) how the goal can be achieved.</li>
</ul></li>
</ul>
<blockquote class="blockquote">
<p>We have to learn the bitter lesson that building in how we think we think does not work in the long run. We should stop trying to find simple ways to think about space, objects, multiple agents, or symmetries‚Ä¶ instead we should build in only the meta-methods that can find and capture this arbitrary complexity. We want AI agents that can discover like we can, not which contain what we have discovered <span class="citation" data-cites="suttonBitterLesson2019">(<a href="#ref-suttonBitterLesson2019" role="doc-biblioref">Sutton 2019</a>)</span>.</p>
</blockquote>
</section>
<section id="supervised-learning" class="level2">
<h2 class="anchored" data-anchor-id="supervised-learning">Supervised learning</h2>
<div class="cell" data-hash="01-text-representation-generation_cache/revealjs/unnamed-chunk-2_8b0c1d7410ef4e6c48b89fd015cf6c7a">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="../assets/images/cats-dogs.png" class="img-fluid figure-img" width="496"></p>
</figure>
</div>
</div>
</div>
<p><strong>Classifiy pictures of cats and dogs:</strong> The goal of a model could be to discover which features distinguish cats from dogs.</p>
</section>
<section id="reinforcement-learning" class="level2">
<h2 class="anchored" data-anchor-id="reinforcement-learning">Reinforcement learning</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell" data-hash="01-text-representation-generation_cache/revealjs/unnamed-chunk-3_c9fe821b68b17cc6cce1faad75dbc500">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="../assets/images/cartpole.gif" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell" data-hash="01-text-representation-generation_cache/revealjs/unnamed-chunk-4_922757a29585b6ae3ed7c0255be38203">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="../assets/images/RL-agent.png" class="img-fluid figure-img" width="803"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="what-is-chatgpt" class="level1" data-background-color="#b48ead">
<h1 data-background-color="#b48ead">What is ChatGPT?</h1>
<div class="absolute" data-top="0" data-left="100%">
<div class="sectionhead">
<p><span style="opacity:0.25">1</span> 2 <span style="opacity:0.25">3 4 5 6</span></p>
</div>
</div>
<section id="chatgpt" class="level2">
<h2 class="anchored" data-anchor-id="chatgpt">ChatGPT</h2>
<p>ChatGPT is a particular kind of LLM and consists of two models:</p>
<p><strong>Base model:</strong> GPT-3.5 oder GPT-4 (generative pre-trained transformer). This model is trained ‚Äúsimply‚Äù to predict the next word in a sequence of words. A base model produces text, but not human-like conversations.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
</div>
<div class="callout-body-container callout-body">
<p>Give the input <code>Once upon a time there was a</code>, the model will predict which word is likely to follow.</p>
</div>
</div>
<p><strong>Assistant model:</strong> This model is trained using reinforcement learning from human feedback to have human-like conversations.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
</div>
<div class="callout-body-container callout-body">
<p>üë©‚Äçüíº: <code>Tell me a story!</code></p>
<p>üí¨: <code>Once upon a time there was a ....</code></p>
</div>
</div>
</section>
<section id="text-generation" class="level2">
<h2 class="anchored" data-anchor-id="text-generation">Text generation</h2>
<ul>
<li><p>LLMs produce text by predicting the next word, one word at a time:</p></li>
<li><p>This is known as ‚Äúauto-regressive next token prediction‚Äù (we‚Äôll discover what tokens are in the next section).</p></li>
<li><p>The model predicts which token is likely to follow, given a sequence of tokens (words, punctuation, emojis, etc.).</p></li>
<li><p>Key idea: this simple procedure is followed over and over again, with <mark style="background: #FFF3A3A6;">each new token being added to the sequence of tokens</mark> that the model uses to predict the next token. <span class="math display">\[ P(w_{w+1} | w_1, w_2, ..., w_t) \]</span></p></li>
<li><p>The sequence of words is called the <mark style="background: #FFF3A3A6;">context</mark>; the text generated by the model is dependent on the context.</p></li>
<li><p>The output of the model is a probability distribution over all possible tokens. The model then chooses one token from this distribution.</p></li>
</ul>
</section>
<section id="text-generation-examples" class="level2">
<h2 class="anchored" data-anchor-id="text-generation-examples">Text generation examples</h2>
<div class="cell" data-hash="01-text-representation-generation_cache/revealjs/unnamed-chunk-5_995ff785dbb436de607ac7a1b30e1b25">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="../assets/images/autoregressive.png" class="img-fluid figure-img" width="538"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>The new context is used to generate the next token, etc.</li>
<li><mark style="background: #FFF3A3A6;">Every token is given an equal amount time (computation per token is constant)</mark>. The model has no concept of more or less important tokens. This is crucial for understanding how LLMs work.</li>
</ul>
</section>
<section id="tokenization" class="level2">
<h2 class="anchored" data-anchor-id="tokenization">Tokenization</h2>
<p>So far we have been talking about words, but LLMs operate with tokens. These are sub-words, and make working with text much easier for the model. A rule of thumb is that one token generally corresponds to ~4 characters of English text. This translates to roughly <span class="math inline">\(\frac{3}{4}\)</span> of a word (so 100 tokens is about 75 words).</p>
<div class="cell" data-hash="01-text-representation-generation_cache/revealjs/unnamed-chunk-6_934e43dcd7fbab1315d5dd22c8825d37">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="../assets/images/tokenization.png" class="img-fluid figure-img" width="675"></p>
</figure>
</div>
</div>
</div>
<p>Feel free to try out the <a href="https://platform.openai.com/tokenizer">OpenAI tokenizer</a>.</p>
</section>
<section id="embeddings" class="level2">
<h2 class="anchored" data-anchor-id="embeddings">Embeddings</h2>
<ul>
<li>The next step is to represent tokens as vectors.</li>
<li>This is called ‚Äúembedding‚Äù the tokens. The vectors are high-dimensional, and the <strong>distance</strong> between vectors measures the similarity between tokens.</li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell" data-hash="01-text-representation-generation_cache/revealjs/unnamed-chunk-7_773fdf1c5ace00a8975835bd5e5182ce">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="../assets/images/embedding.png" class="img-fluid figure-img" width="751"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<ul>
<li>In this 2-dimensional representation, concepts that are ‚Äúrelated‚Äù lie close together.</li>
</ul>
</div>
</div>
<p>You can read more about embeddings <a href="../pages/text-representation.html">in this tutorial</a>.</p>
</section>
</section>
<section id="how-was-chatgpt-trained" class="level1" data-background-color="#b48ead">
<h1 data-background-color="#b48ead">How was ChatGPT trained?</h1>
<div class="absolute" data-top="0" data-left="100%">
<div class="sectionhead">
<p><span style="opacity:0.25">1 2</span> 3 <span style="opacity:0.25">4 5 6</span></p>
</div>
</div>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>Modern LLMs, such as ChatGPT, are trained in 3 steps:</p>
<ol type="1">
<li>Pre-training: the model absorbs knowledge from text datasets.</li>
<li>Supervised finetuning: model is refined to better adhere to specific instructions.</li>
<li>Alignment: hones the LLM to respond more helpfully and safely to user prompts. This step is known as ‚Äúreinforcement learning from human feedback‚Äù (RLHF).</li>
</ol>
</section>
<section id="pre-training-data" class="level2">
<h2 class="anchored" data-anchor-id="pre-training-data">Pre-training Data</h2>
<div class="cell" data-hash="01-text-representation-generation_cache/revealjs/unnamed-chunk-8_285dd13cc37421d58da5a76b4f8483ff">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="../assets/images/karpathy-training-data.png" class="img-fluid figure-img" width="723"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="pre-training" class="level2">
<h2 class="anchored" data-anchor-id="pre-training">Pre-training</h2>
<div class="cell" data-hash="01-text-representation-generation_cache/revealjs/unnamed-chunk-9_9424f3590b9133dcb7b98b981e7a2ba8">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="../assets/images/pretraining.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="../assets/images/karpathy-training-process.png" class="img-fluid figure-img" width="723"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="supervised-fine-tuning" class="level2">
<h2 class="anchored" data-anchor-id="supervised-fine-tuning">Supervised fine-tuning</h2>
<div class="cell" data-hash="01-text-representation-generation_cache/revealjs/unnamed-chunk-10_2792bdc8d2e4f47ae999c1399a092d9d">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="../assets/images/finetuning.png" class="img-fluid figure-img" width="501"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="reinforcement-learning-from-human-feedback-rlhf" class="level2">
<h2 class="anchored" data-anchor-id="reinforcement-learning-from-human-feedback-rlhf">Reinforcement learning from human feedback (RLHF)</h2>
<p>Uses human feedback to rank the model‚Äôs responses. The goal is for the model to learn human preferences for responses.</p>
<div class="cell" data-hash="01-text-representation-generation_cache/revealjs/unnamed-chunk-12_7b8005054a7922d39fc640cedcf02c2d">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/images/RLHF.png" class="img-fluid figure-img" width="2053"></p>
<figcaption>Source: <a href="https://openai.com/blog/chatgpt">openai.com/blog/chatgpt</a></figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="how-should-we-think-about-llms" class="level1" data-background-color="#b48ead">
<h1 data-background-color="#b48ead">How should we think about LLMs?</h1>
<div class="absolute" data-top="0" data-left="100%">
<div class="sectionhead">
<p><span style="opacity:0.25">1 2 3 4</span> 5 <span style="opacity:0.25">6</span></p>
</div>
</div>
<section id="useful-analogy-role-playing-simulator" class="level2">
<h2 class="anchored" data-anchor-id="useful-analogy-role-playing-simulator">Useful analogy: Role-playing simulator</h2>
<blockquote class="blockquote">
<p>We can think of an LLM as a non-deterministic simulator capable of role-playing an infinity of characters, or, to put it another way, capable of stochastically generating an infinity of simulacra.</p>
</blockquote>
<p>Source: <span class="citation" data-cites="shanahanRolePlayLargeLanguage2023">Shanahan, McDonell, and Reynolds (<a href="#ref-shanahanRolePlayLargeLanguage2023" role="doc-biblioref">2023</a>)</span></p>
<ul>
<li>A large language model (LLM) trained as an assistant is a simulator of possible human conversation.</li>
<li>An assistant model does not have any intentions. It is not an entity with its own goals. It is merely trained to respond to user prompts in a human-like way.</li>
<li>An assistant model does not have a ‚Äúpersonality‚Äù or ‚Äúcharacter‚Äù in the traditional sense. It is a simulation of a conversation, and can be thought of as a role-playing simulator.</li>
<li>There is no concept of ‚Äútruth‚Äù or ‚Äúlying‚Äù in a role-playing simulator. The model is not trying to deceive the user, it is simply trying to respond in a human-like way.</li>
</ul>
<p>This is very important when we try to understand why LLMs hallucinate, i.e.&nbsp;generate text that is not factually true.</p>
</section>
<section id="role-playing-simulator" class="level2">
<h2 class="anchored" data-anchor-id="role-playing-simulator">Role-Playing Simulator</h2>
<p><img src="../assets/images/simulator.png" class="img-fluid" width="800"></p>
</section>
</section>
<section id="chatgpt-and-openai-playground" class="level1" data-background-color="#b48ead">
<h1 data-background-color="#b48ead">ChatGPT and OpenAI Playground</h1>
<div class="absolute" data-top="0" data-left="100%">
<div class="sectionhead">
<p><span style="opacity:0.25">1 2 3 4 5</span> 6</p>
</div>
</div>
<section id="chatgpt-vs-openai-playground" class="level2">
<h2 class="anchored" data-anchor-id="chatgpt-vs-openai-playground">ChatGPT vs OpenAI Playground</h2>
<p>OpenAI offer two ways to interact with their assistant model:</p>
<ol type="1">
<li>ChatGPT: A web interface where you can chat with the model.</li>
<li>OpenAI Playground: A web interface that gives users more control over the model.</li>
</ol>
<p>Now open the first activity to learn more about ChatGPT and OpenAI Playground: <a href="../pages/activity-1-explore-llms.html">üëâ Activity 1</a>.</p>
</section>
</section>
<section id="references" class="level1" data-background-color="#2e3440">
<h1 data-background-color="#2e3440">References</h1>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-broschinskiGrafikenErklaertFunktioniert2023" class="csl-entry" role="listitem">
Broschinski, Sebastian, Titus Plattner, Patrick Meier, and Patrick V√∂geli. 2023. <span>‚ÄúIn 9 Grafiken erkl√§rt ‚Äì So funktioniert k√ºnstliche Intelligenz.‚Äù</span> Der Bund. June 10, 2023. <a href="https://www.derbund.ch/so-funktioniert-kuenstliche-intelligenz-599276436215">https://www.derbund.ch/so-funktioniert-kuenstliche-intelligenz-599276436215</a>.
</div>
<div id="ref-shanahanRolePlayLargeLanguage2023" class="csl-entry" role="listitem">
Shanahan, Murray, Kyle McDonell, and Laria Reynolds. 2023. <span>‚ÄúRole-<span>Play</span> with <span>Large Language Models</span>.‚Äù</span> May 25, 2023. <a href="https://doi.org/10.48550/arXiv.2305.16367">https://doi.org/10.48550/arXiv.2305.16367</a>.
</div>
<div id="ref-suttonBitterLesson2019" class="csl-entry" role="listitem">
Sutton, Rich. 2019. <span>‚ÄúThe <span>Bitter Lesson</span>.‚Äù</span> 2019. <a href="http://incompleteideas.net/IncIdeas/BitterLesson.html">http://incompleteideas.net/IncIdeas/BitterLesson.html</a>.
</div>
</div>


</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->

<script>
  // htmlwidgets need to know to resize themselves when slides are shown/hidden.
  // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
  // slide changes (different for each slide format).
  (function () {
    // dispatch for htmlwidgets
    function fireSlideEnter() {
      const event = window.document.createEvent("Event");
      event.initEvent("slideenter", true, true);
      window.document.dispatchEvent(event);
    }

    function fireSlideChanged(previousSlide, currentSlide) {
      fireSlideEnter();

      // dispatch for shiny
      if (window.jQuery) {
        if (previousSlide) {
          window.jQuery(previousSlide).trigger("hidden");
        }
        if (currentSlide) {
          window.jQuery(currentSlide).trigger("shown");
        }
      }
    }

    // hookup for slidy
    if (window.w3c_slidy) {
      window.w3c_slidy.add_observer(function (slide_num) {
        // slide_num starts at position 1
        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
      });
    }

  })();
</script>

<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/virtuelleakademie\.github\.io\/promptly-literate");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>